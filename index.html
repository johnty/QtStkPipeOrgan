<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>QtStkPipeOrgan by johnty</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">QtStkPipeOrgan</h1>
      <h2 class="project-tagline">Realtime Pipe Organ Implementation in STK</h2>
      <a href="https://github.com/johnty/QtStkPipeOrgan" class="btn">View on GitHub</a>
      <a href="https://github.com/johnty/QtStkPipeOrgan/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/johnty/QtStkPipeOrgan/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="a-realtime-pipe-organ-instrument-using-qt-and-stk" class="anchor" href="#a-realtime-pipe-organ-instrument-using-qt-and-stk" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Realtime Pipe Organ Instrument using QT and STK</h1>

<p>Johnty Wang (<a href="mailto:johnty.wang@mail.mcgill.ca">johnty.wang@mail.mcgill.ca</a>)</p>

<p>Project Report for MUMT618, Fall 2015. </p>

<p>Instructor: Prof. Gary Scavone</p>

<h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<ul>
<li><p>This project report describes the implementation of a pipe organ instrument in C++ using the Stk, RtAudio and QT libraries. </p></li>
<li><p>The goal is a cross-platform C++ GUI application that simulates basic types of common organ pipes, the: flue and reed.</p></li>
<li><p>The instrument appears as a virtual MIDI device that can be controlled by hardware controllers: note-on/off messages control pitches while program changes allow toggling of stops. </p></li>
<li><p>Using a single MIDI keyboard, the behaviour of a small chamber organ can be simulated. </p></li>
<li>
<p>The rest of the report consists of the following sections: </p>

<ol>
<li>An introduction and background on the physical layout and relevant parts of a pipe organ. </li>
<li>A discussion on how various parts of the organ may be modelled.</li>
<li>Implementation details of the C++ application so far.</li>
</ol>

<p><img src="img/ryerson.jpg" alt="Ryerson Organ"></p>

<p>The organ at Ryerson United Church, Vancouver BC</p>
</li>
</ul>

<hr>

<h2>
<a id="background" class="anchor" href="#background" aria-hidden="true"><span class="octicon octicon-link"></span></a>Background</h2>

<ul>
<li><p>Despite having a chromatic keyboard, the organ is a wind instrument and very different to most keyboard instruments. (One other exception is the accordion!)</p></li>
<li><p>Unlike other wind instruments, the air is not supplied by the player directly. Traditionally created using manual bellows; nowadays digital blowers.
<img src="https://upload.wikimedia.org/wikipedia/commons/d/d7/HalberstadtBurchardiChurchBellows.jpg" alt="organ bellows">
(img src: wikipedia)</p></li>
<li><p>Air is fed into banks of pipes that produce sound.</p></li>
</ul>

<h3>
<a id="flue-and-reed-pipes" class="anchor" href="#flue-and-reed-pipes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Flue and Reed Pipes</h3>

<p>There are two main kinds of pipes on an organ.</p>

<h4>
<a id="flue-pipes" class="anchor" href="#flue-pipes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Flue Pipes</h4>

<ul>
<li>
<p>The flue pipe is somewhat similar in operation to a flute (or perhaps more appropriately, a recorder)
<img src="https://upload.wikimedia.org/wikipedia/commons/0/01/PSM_V40_D651_Flue_stop_organ_pipes.jpg" alt="flue pipes"></p>

<p>(Clarke 1877)</p>
</li>
<li><p>Frequency is tuned by length of pipe</p></li>
<li>
<p>Typically metal (usually cylindrical) or wood (often rectangular)
<img src="img/pipeshapes.jpg" alt="pipe shapes"></p>

<p>(Clarke 1877)</p>
</li>
</ul>

<h4>
<a id="reed-pipes" class="anchor" href="#reed-pipes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reed Pipes</h4>

<ul>
<li>
<p>The reed pipe is more like a clarinet (or very large single reed harmonica, perhaps).
<img src="img/reedpipe.jpg" alt="wind chest"></p>

<p>(Clarke 1877)</p>
</li>
<li><p>The pipes are grouped together in a row (called "stops" or "ranks"), and connected to the air source or "wind chest".</p></li>
</ul>

<p><img src="img/windchests.png" alt="wind chest">
<img src="img/windchests2.png" alt="cross sectional"></p>

<p>(Clarke 1877)</p>

<ul>
<li><p>If a stop is active, there is a mechanical (or electrical) link between the keyboard note, and the valve associated with a particular pipe.</p></li>
<li><p>Stops that are "unique" to the instrument are called principles, while others often bear the names of instruments the stop is supposed to imitate.</p></li>
<li><p>A large church organ can have thousands of pipes. (e.g. St Andrews &amp; St Paul, Montreal: ~7000 pipes!)</p></li>
</ul>

<h3>
<a id="adjusting-the-sound" class="anchor" href="#adjusting-the-sound" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adjusting the Sound</h3>

<ul>
<li><p>Control of individual pipe by adjusting its physical parameters (Voicing)</p></li>
<li><p>Choosing combinations of stops to be used (Registration)</p></li>
</ul>

<h3>
<a id="control-systeminputs" class="anchor" href="#control-systeminputs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Control System/Inputs</h3>

<p>Keyboard: 6 octaves of chromatic notes,. Set of 3-6 depending on instrument. Referred to as manuals.</p>

<p>Pedalboard: 1 ~ 3 octaves of chromatic notes, activated by the foot. Traditionally assigned to large, bass pipes.</p>

<p>Stops: draw tabs that activate each set of pipes</p>

<p>Foot switches: discrete buttons for activating settings, swell shutters that control volume by adjusting blinds in which certain pipes are housed</p>

<p>Traditionally, everything is linked mechanically (Tracker organs).</p>

<p><img src="https://upload.wikimedia.org/wikipedia/commons/9/9b/Pipe_organ_tracker_action.jpg" alt="Tracker Organ"></p>

<p>Most modern organs are digitally controlled. Allows more flexible coupling, and quick recall of complex combinations.</p>

<p><img src="https://upload.wikimedia.org/wikipedia/commons/7/74/Organ_Console%2C_Holy_Trinity%2C_Buffalo.jpeg" alt="Holy Trinity Organ Console"></p>

<p>(Organ console at Holy Trinity, Buffalo. src: wikipedia)</p>

<h4>
<a id="the-organ-is-probably-the-worlds-first-synthesizer" class="anchor" href="#the-organ-is-probably-the-worlds-first-synthesizer" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>The Organ is probably the world's first "synthesizer"</em>
</h4>

<h4>
<a id="can-fully-reproduce-a-performance-from-recorded-signals" class="anchor" href="#can-fully-reproduce-a-performance-from-recorded-signals" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>Can "fully reproduce" a performance from recorded signals</em>
</h4>

<h2>
<a id="components-that-may-be-of-interest-for-modelling" class="anchor" href="#components-that-may-be-of-interest-for-modelling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Components that may be of interest for Modelling</h2>

<ul>
<li><p>Pipes: physical response of the different kinds of pipes (geometry, materials)</p></li>
<li><p>Interaction between pipes (e.g. detuned sets of stops for tremolo effects)</p></li>
<li><p>Imperfections due to environment conditions (e.g. temperature fluctuations)</p></li>
<li><p>Air source: fluctuations in air pressure; physical limits of blowers, tracker actuation</p></li>
<li><p>Control system: coupling, mapping of manuals to different registers</p></li>
<li><p>Reverberance of spaces</p></li>
</ul>

<h2>
<a id="commercial-products" class="anchor" href="#commercial-products" aria-hidden="true"><span class="octicon octicon-link"></span></a>Commercial Products</h2>

<p>One of the more famous virtual software organ systems is <a href="https://www.hauptwerk.com/learn-more/overview/">Hauptwerk</a>. It has an extensive sample-based library of many organs.</p>

<h3>
<a id="implementation" class="anchor" href="#implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implementation</h3>

<p>QT Application: cross platform C++ development environment</p>

<ul>
<li>User interface for basic control, visual feedback of status</li>
<li>MIDI interface for reading input from external controller</li>
<li>Synthesis module for producing sound, managing voices

<ul>
<li>STK Voicer class for managing polyphony</li>
<li>STK Instruments for each type of "pipe"</li>
</ul>
</li>
</ul>

<p><img src="img/system.png" alt="test "></p>

<h3>
<a id="synthesis-organ-model" class="anchor" href="#synthesis-organ-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Synthesis: Organ Model</h3>

<p>As described in the previous section, there are two main categories of organ pipes: the flue and the reed.</p>

<p>A first-pass attempt at putting something together, given the existing models in Stk might look like:</p>

<p><img src="img/keyboard-flutes.png" alt="keyboard flutes?"></p>

<p>Or, if we're looking at reed pipes:</p>

<p><img src="img/keyboard-clarinet.png" alt="keyboard clarinets?"></p>

<h3>
<a id="realtime-audiomidi-considerations" class="anchor" href="#realtime-audiomidi-considerations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Realtime Audio/MIDI Considerations</h3>

<ul>
<li><p>ASIO drivers were used (in the Windows version) for RtAudio DAC</p></li>
<li><p>512 buffer size was used. This means at 44100kHz sample rate, we need to compute the 512 samples every ~11ms (also the system latency)</p></li>
<li><p>Will affect upper limit of polyphony</p></li>
<li>
<p>A very crude sine wave test was done as a "stress test":</p>

<ul>
<li>~500 waves on i5 Mobile CPU</li>
<li>~900 waves on i5 Desktop CPU</li>
</ul>
</li>
<li><p>Actual synthesis is more computationally extensive, but this gives a good ballpark idea</p></li>
<li><p>RtMIDI for MIDI Input. If using as a soft instrument, virtual inputs possible (OSX/Linux), loopMidi on Windows</p></li>
</ul>

<h3>
<a id="demonstration" class="anchor" href="#demonstration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demonstration</h3>

<p><img src="https://davidcmoisan.files.wordpress.com/2011/09/clippy-bluescreen-copy_thumb.png?w=662&amp;h=529" alt="broken"></p>

<h3>
<a id="further-development" class="anchor" href="#further-development" aria-hidden="true"><span class="octicon octicon-link"></span></a>Further Development</h3>

<ul>
<li><p>Try actually modelling pipe shapes, creating more groups of stops that behave more like an organ and less like the wind instrument models</p></li>
<li><p>Modelling other effects such as swell boxes, reverb of different spaces</p></li>
<li><p>Use with more controllers, so multiple stops can be played concurrently on each controller</p></li>
<li><p>Control with non-keyboard controllers</p></li>
</ul>

<h3>
<a id="references" class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h3>

<p>D. Baker. The Organ : a Brief Guide to its Construction, History, Usage and Music. 1991.</p>

<p>W. H. Clarke. An Outline of the Structure of the Pipe Organ. Oliver Ditson &amp; Co. Boston. 1877.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/johnty/QtStkPipeOrgan">QtStkPipeOrgan</a> is maintained by <a href="https://github.com/johnty">johnty</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
